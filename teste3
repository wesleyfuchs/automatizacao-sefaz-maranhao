import requests
from bs4 import BeautifulSoup
from PIL import Image
import pytesseract
from io import BytesIO
import pyautogui
import time

# Caminho para o executável do Tesseract (altere conforme necessário)
pytesseract.pytesseract.tesseract_cmd = r'C:\Program Files\Tesseract-OCR\tesseract.exe'

# URL da página
url_pagina = 'https://example.com/sua_pagina'

# Função para obter a URL da imagem a partir do HTML da página
def obter_url_imagem(url_pagina):
    response = requests.get(url_pagina)
    soup = BeautifulSoup(response.text, 'html.parser')

    # Substitua 'class_da_imagem' pela classe real da imagem
    imagem = soup.find('img', {'id': 'form1:captcha'})
    url_imagem = imagem['src']

    return url_imagem

# Função para realizar OCR em uma imagem a partir da URL
def ocr_em_imagem_url(url):
    response = requests.get(url)
    imagem = Image.open(BytesIO(response.content))
    texto = pytesseract.image_to_string(imagem)
    return texto

# Função para preencher um campo no site com o texto extraído
def preencher_campo_com_texto(texto):
    # Supondo que você tenha identificado o campo usando pyautogui antes
    # Substitua as coordenadas e a ação com base na sua implementação
    pyautogui.click(x=100, y=200)  # Substitua com as coordenadas reais do seu campo
    pyautogui.write(texto)

# Obtendo a URL da imagem a partir do HTML da página
url_imagem = obter_url_imagem(url_pagina)

# Extraindo texto da imagem
texto_extraido = ocr_em_imagem_url(url_imagem)

# Preenchendo um campo no site com o texto extraído
preencher_campo_com_texto(texto_extraido)

# Aguardando um curto período para a ação ser visualizada
time.sleep(2)
